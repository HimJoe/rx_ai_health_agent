<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Rx-AI Health Agent</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <!-- Bulma CSS for layout -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bulma@0.9.4/css/bulma.min.css">
  <style>
    html, body { height: 100%; }
    .navbar-item img { max-height: 3rem; }
    #chat-window { height: 60vh; overflow-y: auto; }
    .message { margin: 0.5rem 0; }
    .message.user .box { background-color: #cce5ff; }
    .message.bot .box  { background-color: #f5f5f5; }
    .is-hidden-mobile { border-right: 1px solid #dbdbdb; }
  </style>
</head>
<body>
  <!-- Navbar -->
  <nav class="navbar is-light" role="navigation" aria-label="main navigation">
    <div class="navbar-brand">
      <a class="navbar-item" href="#">
        <img src="logo.png" alt="Rx-AI Logo">
        <span class="ml-2 has-text-weight-bold">Rx-AI Health Agent</span>
      </a>
      <a role="button" class="navbar-burger" data-target="navMenu">
        <span aria-hidden="true"></span>
        <span aria-hidden="true"></span>
        <span aria-hidden="true"></span>
      </a>
    </div>
    <div id="navMenu" class="navbar-menu">
      <div class="navbar-end">
        <a href="#overview"  class="navbar-item">Overview</a>
        <a href="#architecture" class="navbar-item">Architecture</a>
        <a href="#demo"      class="navbar-item">Demo</a>
        <a href="#code"      class="navbar-item">Code</a>
        <a href="#references"class="navbar-item">References</a>
      </div>
    </div>
  </nav>

  <div class="columns is-gapless is-fullheight">
    <!-- Sidebar -->
    <aside class="column is-3 menu is-hidden-mobile px-4 pt-4">
      <p class="menu-label">Your Profile</p>
      <ul class="menu-list">
        <li><input id="input-age"        class="input"  type="number" placeholder="Age"></li>
        <li><input id="input-conditions" class="input"  type="text"   placeholder="Conditions"></li>
        <li><button id="save-profile"    class="button is-info is-fullwidth">Save Profile</button></li>
      </ul>
      <p class="menu-label">Try Examples</p>
      <ul class="menu-list">
        <li><a class="demo-example" data-query="I feel dizzy and my heart is racing. What should I do?">Dizziness</a></li>
        <li><a class="demo-example" data-query="I have chest pain and shortness of breath.">Chest Pain</a></li>
      </ul>
    </aside>

    <!-- Main content -->
    <main class="column">
      <section class="section" id="overview">
        <h2 class="title">Overview</h2>
        <p><strong>Rx-AI</strong> delivers personalized, evidence-grounded health advice by combining an LLM with a medical vector store and FHIR-style user profiles.</p>
        <p><a href="paper.pdf" target="_blank" class="button is-link is-light">Download Paper (PDF)</a></p>
      </section>

      <section class="section" id="architecture">
        <h2 class="title">Architecture</h2>
        <ul>
          <li>Health Knowledge Base (FAISS/Pinecone)</li>
          <li>User Profile Manager (FHIR-inspired)</li>
          <li>RAG Engine (query → retrieve → LLM)</li>
          <li>Safety Module (emergency detection, disclaimers)</li>
        </ul>
        <figure class="image">
          <img src="architecture-diagram.png" alt="System Architecture">
        </figure>
      </section>

      <section class="section" id="demo">
        <h2 class="title">Live Demo</h2>
        <div id="chat-window" class="box"></div>
        <div class="field has-addons">
          <div class="control is-expanded">
            <input id="user-input" class="input" type="text" placeholder="Type your question...">
          </div>
          <div class="control">
            <button id="send-btn" class="button is-primary">Send</button>
          </div>
        </div>
      </section>

      <section class="section" id="code">
        <h2 class="title">Code & Deployment</h2>
        <p>Explore the full source and setup instructions on GitHub:</p>
        <a href="https://github.com/your-org/rx_ai_health_agent" class="button is-link">GitHub Repo</a>
      </section>

      <section class="section" id="references">
        <h2 class="title">References</h2>
        <ol>
          <li>Joshi &amp; Kumari (2025). Rx-AI: Retrieval-Augmented Health Agent.</li>
          <li><a href="https://www.hl7.org/fhir/">HL7 FHIR Standard</a></li>
          <li>Mayo Clinic Guidelines (2024).</li>
        </ol>
      </section>

      <footer class="footer">
        <div class="content has-text-centered">
          &copy; 2025 Rx-AI Project • Built with <span style="color:red;">❤</span> on GitHub Pages
        </div>
      </footer>
    </main>
  </div>

  <script>
    // Navbar burger for mobile
    document.addEventListener('DOMContentLoaded', () => {
      document.querySelectorAll('.navbar-burger').forEach(burger => {
        burger.addEventListener('click', () => {
          document.getElementById(burger.dataset.target)
            .classList.toggle('is-active');
        });
      });
    });

    const API_URL = 'https://your-backend.example.com/chat'; 
    let userProfile = JSON.parse(localStorage.getItem('rxai_profile')) || { age: '', conditions: '' };

    // Load saved profile
    document.getElementById('input-age').value = userProfile.age;
    document.getElementById('input-conditions').value = userProfile.conditions;

    // Save profile
    document.getElementById('save-profile').onclick = () => {
      userProfile.age = document.getElementById('input-age').value;
      userProfile.conditions = document.getElementById('input-conditions').value;
      localStorage.setItem('rxai_profile', JSON.stringify(userProfile));
      alert('Profile saved!');
    };

    // Example queries
    document.querySelectorAll('.demo-example').forEach(el => {
      el.onclick = () => {
        document.getElementById('user-input').value = el.dataset.query;
        sendMessage();
      };
    });

    // Chat logic
    const chatWindow = document.getElementById('chat-window');
    const inputEl = document.getElementById('user-input');
    const sendBtn = document.getElementById('send-btn');

    async function sendMessage() {
      const text = inputEl.value.trim();
      if (!text) return;
      appendMessage(text, 'user');
      inputEl.value = '';
      sendBtn.disabled = true;

      try {
        const resp = await fetch(API_URL, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ 
            user_id: 'demo', 
            query: text, 
            profile: userProfile 
          })
        });
        const data = await resp.json();
        const botText = data.response + (data.sources?.length ? `<br><em>Sources: ${data.sources.join(', ')}</em>` : '');
        appendMessage(botText, 'bot');
      } catch (err) {
        appendMessage('⚠️ Error connecting to backend.', 'bot');
      }

      sendBtn.disabled = false;
      chatWindow.scrollTop = chatWindow.scrollHeight;
    }

    function appendMessage(text, role) {
      const wrapper = document.createElement('div');
      wrapper.className = 'message ' + role;
      const box = document.createElement('div');
      box.className = 'box';
      box.innerHTML = text.replace(/\\n/g, '<br>');
      wrapper.appendChild(box);
      chatWindow.appendChild(wrapper);
    }

    sendBtn.addEventListener('click', sendMessage);
    inputEl.addEventListener('keypress', e => {
      if (e.key === 'Enter') sendMessage();
    });
  </script>
</body>
</html>

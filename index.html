<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Health Agent - Final Version</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: Arial, sans-serif;
        }
        
        body {
            background-color: #f5f5f5;
            padding: 20px;
        }
        
        .container {
            max-width: 1000px;
            margin: 0 auto;
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        header {
            background-color: #3498db;
            color: white;
            padding: 20px;
            border-radius: 8px 8px 0 0;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        header h1 {
            font-size: 24px;
        }
        
        .edit-profile-btn {
            background-color: white;
            color: #3498db;
            border: none;
            padding: 8px 16px;
            border-radius: 4px;
            cursor: pointer;
            font-weight: bold;
        }
        
        .main-section {
            display: flex;
            min-height: 500px;
        }
        
        @media (max-width: 768px) {
            .main-section {
                flex-direction: column;
            }
        }
        
        .sidebar {
            width: 300px;
            padding: 20px;
            border-right: 1px solid #eee;
        }
        
        @media (max-width: 768px) {
            .sidebar {
                width: 100%;
                border-right: none;
                border-bottom: 1px solid #eee;
            }
        }
        
        .section-title {
            font-size: 18px;
            margin-bottom: 15px;
            padding-bottom: 8px;
            border-bottom: 1px solid #eee;
            color: #3498db;
        }
        
        .info-group {
            margin-bottom: 20px;
        }
        
        .info-row {
            display: flex;
            justify-content: space-between;
            margin-bottom: 8px;
        }
        
        .info-label {
            font-weight: bold;
            color: #666;
        }
        
        .health-item {
            padding: 8px 0;
            border-bottom: 1px solid #eee;
            display: flex;
            justify-content: space-between;
        }
        
        .chat-section {
            flex-grow: 1;
            display: flex;
            flex-direction: column;
            padding: 20px;
        }
        
        .chat-messages {
            flex-grow: 1;
            overflow-y: auto;
            margin-bottom: 15px;
            min-height: 300px;
            max-height: 400px;
            border: 1px solid #eee;
            border-radius: 8px;
            padding: 15px;
        }
        
        .message {
            margin-bottom: 15px;
            max-width: 80%;
            padding: 10px 15px;
            border-radius: 8px;
        }
        
        .agent-message {
            background-color: #f1f1f1;
            margin-right: auto;
        }
        
        .user-message {
            background-color: #3498db;
            color: white;
            margin-left: auto;
        }
        
        .message-time {
            font-size: 12px;
            opacity: 0.7;
            margin-top: 5px;
        }
        
        .source-info {
            font-size: 12px;
            font-style: italic;
            color: #3498db;
            margin-top: 5px;
        }
        
        .input-area {
            display: flex;
            margin-bottom: 15px;
        }
        
        .input-area input {
            flex-grow: 1;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
            margin-right: 10px;
        }
        
        .input-area button {
            padding: 10px 20px;
            background-color: #3498db;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }
        
        .suggestions {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin-bottom: 15px;
        }
        
        .suggestion-btn {
            background-color: #f1f1f1;
            border: 1px solid #ddd;
            border-radius: 20px;
            padding: 8px 12px;
            font-size: 14px;
            cursor: pointer;
        }
        
        .action-buttons {
            display: flex;
            gap: 10px;
        }
        
        .action-btn {
            padding: 8px 16px;
            border: 1px solid #ddd;
            border-radius: 4px;
            background-color: #f9f9f9;
            cursor: pointer;
        }
        
        .data-form {
            background-color: #f9f9f9;
            padding: 15px;
            border-radius: 8px;
            margin-top: 15px;
            display: none;
        }
        
        .data-form h3 {
            margin-bottom: 15px;
            color: #3498db;
        }
        
        .form-group {
            margin-bottom: 10px;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
        }
        
        .form-group input,
        .form-group select,
        .form-group textarea {
            width: 100%;
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
        }
        
        .form-buttons {
            display: flex;
            justify-content: flex-end;
            gap: 10px;
            margin-top: 15px;
        }
        
        .form-btn {
            padding: 8px 16px;
            border-radius: 4px;
            cursor: pointer;
        }
        
        .cancel-btn {
            background-color: #f1f1f1;
            border: 1px solid #ddd;
        }
        
        .submit-btn {
            background-color: #2ecc71;
            color: white;
            border: none;
        }
        
        .visualization {
            margin-top: 15px;
            padding: 15px;
            background-color: #f9f9f9;
            border-radius: 8px;
        }
        
        .bp-chart {
            display: flex;
            align-items: flex-end;
            height: 200px;
            margin: 20px 0;
            border-bottom: 2px solid #ddd;
            padding-bottom: 30px;
            position: relative;
        }
        
        .chart-bar {
            width: 30px;
            background-color: #3498db;
            margin: 0 20px;
            position: relative;
        }
        
        .chart-bar.elevated {
            background-color: #e74c3c;
        }
        
        .chart-label {
            position: absolute;
            bottom: -30px;
            left: 0;
            width: 100%;
            text-align: center;
            font-size: 12px;
        }
        
        .chart-value {
            position: absolute;
            bottom: -45px;
            left: 0;
            width: 100%;
            text-align: center;
            font-size: 12px;
            color: #666;
        }
        
        /* Modal styles */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            z-index: 1000;
        }
        
        .modal-content {
            background-color: white;
            margin: 50px auto;
            padding: 20px;
            width: 80%;
            max-width: 600px;
            border-radius: 8px;
            max-height: 80vh;
            overflow-y: auto;
        }
        
        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 1px solid #eee;
        }
        
        .modal-title {
            font-size: 20px;
            color: #3498db;
        }
        
        .close-modal {
            font-size: 24px;
            cursor: pointer;
            color: #999;
        }
        
        .tab-container {
            margin-bottom: 20px;
        }
        
        .tab-nav {
            display: flex;
            border-bottom: 1px solid #eee;
            margin-bottom: 15px;
        }
        
        .tab-button {
            padding: 8px 15px;
            background: none;
            border: none;
            border-bottom: 3px solid transparent;
            cursor: pointer;
        }
        
        .tab-button.active {
            border-bottom-color: #3498db;
            color: #3498db;
            font-weight: bold;
        }
        
        .tab-content {
            display: none;
        }
        
        .tab-content.active {
            display: block;
        }
        
        /* Add condition/medication row */
        .add-row {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
        }
        
        .add-row input {
            flex-grow: 1;
        }
        
        .add-row button {
            padding: 8px 12px;
            background-color: #3498db;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>AI Health Agent for Personalized Health Management</h1>
            <button class="edit-profile-btn" id="edit-profile-btn">Edit Profile</button>
        </header>
        
        <div class="main-section">
            <aside class="sidebar">
                <div class="info-group">
                    <h2 class="section-title">Personal Information</h2>
                    <div class="info-row">
                        <span class="info-label">Age:</span>
                        <span id="user-age">42</span>
                    </div>
                    <div class="info-row">
                        <span class="info-label">Gender:</span>
                        <span id="user-gender">Female</span>
                    </div>
                    <div class="info-row">
                        <span class="info-label">Height:</span>
                        <span id="user-height">165 cm</span>
                    </div>
                    <div class="info-row">
                        <span class="info-label">Weight:</span>
                        <span id="user-weight">68 kg</span>
                    </div>
                    <div class="info-row">
                        <span class="info-label">Activity Level:</span>
                        <span id="user-activity">Moderate</span>
                    </div>
                </div>
                
                <div class="info-group">
                    <h2 class="section-title">Health Conditions</h2>
                    <div id="health-conditions">
                        <div class="health-item">
                            <span>Mild hypertension</span>
                            <span>June 2023</span>
                        </div>
                        <div class="health-item">
                            <span>Seasonal allergies</span>
                            <span>March 2020</span>
                        </div>
                    </div>
                </div>
                
                <div class="info-group">
                    <h2 class="section-title">Medications</h2>
                    <div id="medications">
                        <div class="health-item">
                            <span>Lisinopril</span>
                            <span>10mg, daily</span>
                        </div>
                        <div class="health-item">
                            <span>Loratadine</span>
                            <span>10mg, as needed</span>
                        </div>
                    </div>
                </div>
                
                <div class="info-group">
                    <h2 class="section-title">Recent Health Metrics</h2>
                    <div class="info-row">
                        <span class="info-label">Sleep:</span>
                        <span id="metrics-sleep">6.5 hrs, fair quality</span>
                    </div>
                    <div class="info-row">
                        <span class="info-label">Activity:</span>
                        <span id="metrics-activity">8,750 steps, 42 min</span>
                    </div>
                    <div class="info-row">
                        <span class="info-label">Blood pressure:</span>
                        <span id="metrics-bp">132/84</span>
                    </div>
                </div>
            </aside>
            
            <div class="chat-section">
                <div class="chat-messages" id="chat-messages">
                    <div class="message agent-message">
                        <div>Welcome to your AI Health Agent! I'm here to provide personalized health recommendations based on your profile and needs. How can I assist you today?</div>
                        <div class="message-time">10:30 AM</div>
                    </div>
                </div>
                
                <div class="suggestions">
                    <button class="suggestion-btn">How can I improve my sleep quality?</button>
                    <button class="suggestion-btn">What might be causing my fatigue lately?</button>
                    <button class="suggestion-btn">How can I better manage my hypertension?</button>
                    <button class="suggestion-btn">Should I adjust my exercise routine?</button>
                </div>
                
                <div class="input-area">
                    <input type="text" id="message-input" placeholder="Type your health question here...">
                    <button id="send-btn">Send</button>
                </div>
                
                <div class="action-buttons">
                    <button class="action-btn" id="add-data-btn">Add Health Data</button>
                    <button class="action-btn" id="visualize-btn">Show Health Trends</button>
                </div>
                
                <!-- Health Data Form -->
                <div id="data-form" class="data-form">
                    <h3>Add Health Data</h3>
                    
                    <div class="form-group">
                        <label for="data-type">Select Data Type:</label>
                        <select id="data-type">
                            <option value="sleep">Sleep</option>
                            <option value="activity">Physical Activity</option>
                            <option value="bp">Blood Pressure</option>
                        </select>
                    </div>
                    
                    <!-- Sleep inputs -->
                    <div id="sleep-inputs">
                        <div class="form-group">
                            <label for="sleep-hours">Hours of Sleep:</label>
                            <input type="number" id="sleep-hours" min="0" max="24" step="0.1">
                        </div>
                        <div class="form-group">
                            <label for="sleep-quality">Sleep Quality:</label>
                            <select id="sleep-quality">
                                <option value="poor">Poor</option>
                                <option value="fair">Fair</option>
                                <option value="good">Good</option>
                                <option value="excellent">Excellent</option>
                            </select>
                        </div>
                    </div>
                    
                    <!-- Activity inputs (initially hidden) -->
                    <div id="activity-inputs" style="display: none;">
                        <div class="form-group">
                            <label for="activity-steps">Steps:</label>
                            <input type="number" id="activity-steps" min="0">
                        </div>
                        <div class="form-group">
                            <label for="activity-minutes">Active Minutes:</label>
                            <input type="number" id="activity-minutes" min="0">
                        </div>
                    </div>
                    
                    <!-- Blood pressure inputs (initially hidden) -->
                    <div id="bp-inputs" style="display: none;">
                        <div class="form-group">
                            <label for="systolic">Systolic (top number):</label>
                            <input type="number" id="systolic" min="70" max="220">
                        </div>
                        <div class="form-group">
                            <label for="diastolic">Diastolic (bottom number):</label>
                            <input type="number" id="diastolic" min="40" max="120">
                        </div>
                    </div>
                    
                    <div class="form-buttons">
                        <button class="form-btn cancel-btn" id="cancel-btn">Cancel</button>
                        <button class="form-btn submit-btn" id="submit-btn">Save Data</button>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Profile Edit Modal -->
    <div id="profile-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">Edit Your Health Profile</h2>
                <span class="close-modal" id="close-profile-modal">&times;</span>
            </div>
            
            <div class="tab-container">
                <div class="tab-nav">
                    <button class="tab-button active" data-tab="personal-tab">Personal Info</button>
                    <button class="tab-button" data-tab="conditions-tab">Health Conditions</button>
                    <button class="tab-button" data-tab="medications-tab">Medications</button>
                </div>
                
                <!-- Personal Info Tab -->
                <div id="personal-tab" class="tab-content active">
                    <div class="form-group">
                        <label for="edit-age">Age:</label>
                        <input type="number" id="edit-age" min="0" max="120">
                    </div>
                    <div class="form-group">
                        <label for="edit-gender">Gender:</label>
                        <select id="edit-gender">
                            <option value="Male">Male</option>
                            <option value="Female">Female</option>
                            <option value="Non-binary">Non-binary</option>
                            <option value="Prefer not to say">Prefer not to say</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="edit-height">Height (cm):</label>
                        <input type="number" id="edit-height" min="0" max="300">
                    </div>
                    <div class="form-group">
                        <label for="edit-weight">Weight (kg):</label>
                        <input type="number" id="edit-weight" min="0" max="500" step="0.1">
                    </div>
                    <div class="form-group">
                        <label for="edit-activity">Activity Level:</label>
                        <select id="edit-activity">
                            <option value="Sedentary">Sedentary</option>
                            <option value="Lightly active">Lightly active</option>
                            <option value="Moderate">Moderate</option>
                            <option value="Very active">Very active</option>
                            <option value="Extremely active">Extremely active</option>
                        </select>
                    </div>
                    <div class="form-buttons">
                        <button class="form-btn submit-btn" id="save-personal-btn">Save Changes</button>
                    </div>
                </div>
                
                <!-- Health Conditions Tab -->
                <div id="conditions-tab" class="tab-content">
                    <div id="conditions-list">
                        <!-- Existing conditions will be displayed here -->
                    </div>
                    <div class="add-row">
                        <input type="text" id="new-condition" placeholder="Condition name">
                        <input type="text" id="condition-date" placeholder="Diagnosis date (e.g., June 2023)">
                        <button id="add-condition-btn">Add</button>
                    </div>
                </div>
                
                <!-- Medications Tab -->
                <div id="medications-tab" class="tab-content">
                    <div id="medications-list">
                        <!-- Existing medications will be displayed here -->
                    </div>
                    <div class="add-row">
                        <input type="text" id="new-medication" placeholder="Medication name">
                        <input type="text" id="medication-dosage" placeholder="Dosage (e.g., 10mg)">
                        <input type="text" id="medication-frequency" placeholder="Frequency (e.g., daily)">
                        <button id="add-medication-btn">Add</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
    (function() {
        // Get DOM elements
        const chatMessages = document.getElementById('chat-messages');
        const messageInput = document.getElementById('message-input');
        const sendButton = document.getElementById('send-btn');
        const suggestionButtons = document.querySelectorAll('.suggestion-btn');
        const addDataButton = document.getElementById('add-data-btn');
        const visualizeButton = document.getElementById('visualize-btn');
        const dataForm = document.getElementById('data-form');
        const dataTypeSelect = document.getElementById('data-type');
        const cancelButton = document.getElementById('cancel-btn');
        const submitButton = document.getElementById('submit-btn');
        
        // Profile edit elements
        const editProfileBtn = document.getElementById('edit-profile-btn');
        const profileModal = document.getElementById('profile-modal');
        const closeProfileModal = document.getElementById('close-profile-modal');
        const tabButtons = document.querySelectorAll('.tab-button');
        const savePersonalBtn = document.getElementById('save-personal-btn');
        const addConditionBtn = document.getElementById('add-condition-btn');
        const addMedicationBtn = document.getElementById('add-medication-btn');
        
        // Data form input sections
        const sleepInputs = document.getElementById('sleep-inputs');
        const activityInputs = document.getElementById('activity-inputs');
        const bpInputs = document.getElementById('bp-inputs');
        
        // Add event listeners
        sendButton.addEventListener('click', function() {
            const message = messageInput.value.trim();
            if (!message) return;
            
            // Add user message to chat
            addMessageToChat(message, 'user');
            
            // Clear input
            messageInput.value = '';
            
            // Generate agent response after a short delay
            setTimeout(function() {
                generateResponse(message);
            }, 800);
        });
        
        messageInput.addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                const message = messageInput.value.trim();
                if (!message) return;
                
                // Add user message to chat
                addMessageToChat(message, 'user');
                
                // Clear input
                messageInput.value = '';
                
                // Generate agent response after a short delay
                setTimeout(function() {
                    generateResponse(message);
                }, 800);
            }
        });
        
        suggestionButtons.forEach(button => {
            button.addEventListener('click', function() {
                const message = this.textContent.trim();
                messageInput.value = message;
                
                // Add user message to chat
                addMessageToChat(message, 'user');
                
                // Clear input
                messageInput.value = '';
                
                // Generate agent response after a short delay
                setTimeout(function() {
                    generateResponse(message);
                }, 800);
            });
        });
        
        addDataButton.addEventListener('click', function() {
            dataForm.style.display = 'block';
        });
        
        visualizeButton.addEventListener('click', showVisualization);
        
        dataTypeSelect.addEventListener('change', function() {
            // Hide all input sections
            sleepInputs.style.display = 'none';
            activityInputs.style.display = 'none';
            bpInputs.style.display = 'none';
            
            // Show the selected section
            const selectedType = this.value;
            if (selectedType === 'sleep') {
                sleepInputs.style.display = 'block';
            } else if (selectedType === 'activity') {
                activityInputs.style.display = 'block';
            } else if (selectedType === 'bp') {
                bpInputs.style.display = 'block';
            }
        });
        
        cancelButton.addEventListener('click', function() {
            dataForm.style.display = 'none';
        });
        
        submitButton.addEventListener('click', saveHealthData);
        
        // Profile edit events
        editProfileBtn.addEventListener('click', function() {
            loadCurrentProfile();
            profileModal.style.display = 'block';
        });
        
        closeProfileModal.addEventListener('click', function() {
            profileModal.style.display = 'none';
        });
        
        tabButtons.forEach(button => {
            button.addEventListener('click', function() {
                // Hide all tabs
                document.querySelectorAll('.tab-content').forEach(tab => {
                    tab.classList.remove('active');
                });
                
                // Deactivate all buttons
                tabButtons.forEach(btn => {
                    btn.classList.remove('active');
                });
                
                // Show selected tab
                const tabId = this.getAttribute('data-tab');
                document.getElementById(tabId).classList.add('active');
                
                // Activate this button
                this.classList.add('active');
            });
        });
        
        savePersonalBtn.addEventListener('click', savePersonalInfo);
        addConditionBtn.addEventListener('click', addCondition);
        addMedicationBtn.addEventListener('click', addMedication);
        
        // Initialize
        initProfileEditor();
        
        // Functions
        function addMessageToChat(text, sender) {
            const messageDiv = document.createElement('div');
            messageDiv.className = `message ${sender}-message`;
            
            const content = document.createElement('div');
            content.textContent = text;
            messageDiv.appendChild(content);
            
            const time = document.createElement('div');
            time.className = 'message-time';
            const now = new Date();
            time.textContent = `${now.getHours()}:${now.getMinutes().toString().padStart(2, '0')}`;
            messageDiv.appendChild(time);
            
            chatMessages.appendChild(messageDiv);
            
            // Scroll to bottom
            chatMessages.scrollTop = chatMessages.scrollHeight;
        }
        
        function generateResponse(userMessage) {
            // Keyword-based responses
            let response = '';
            let source = '';
            
            if (userMessage.toLowerCase().includes('sleep') || userMessage.toLowerCase().includes('tired') || userMessage.toLowerCase().includes('fatigue')) {
                response = "Looking at your sleep patterns, I see you've been averaging about 6.5 hours with 'fair' quality. For someone with mild hypertension, quality sleep is particularly important.\n\nSome personalized recommendations:\n1. Maintain a consistent sleep schedule (even on weekends)\n2. Consider taking your Lisinopril in the morning rather than evening, as it can sometimes affect sleep\n3. Your activity level is good (8,750 steps yesterday), but try to complete exercise at least 3-4 hours before bedtime\n4. Create a calming pre-sleep routine without screens\n5. Your low sodium dietary preference is excellent for hypertension and can also help reduce nighttime awakenings";
                source = "National Sleep Foundation, 2024; American Heart Association, 2023";
            }
            else if (userMessage.toLowerCase().includes('blood pressure') || userMessage.toLowerCase().includes('hypertension')) {
                response = "Your recent blood pressure reading of 132/84 shows mild elevation. For someone with your profile, here are targeted recommendations:\n\n1. Continue your prescribed Lisinopril (10mg daily)\n2. Maintain your low-sodium diet approach - this is excellent for managing hypertension\n3. Your current activity level (moderate with ~8,750 steps) is beneficial; aim for consistency with 30+ minutes of activity daily\n4. Consider incorporating stress management techniques like deep breathing or meditation\n5. Work on improving sleep quality, as your recent average of 6.5 hours is below optimal and can impact blood pressure";
                source = "American Heart Association Guidelines, 2023; American College of Cardiology, 2024";
            }
            else if (userMessage.toLowerCase().includes('exercise') || userMessage.toLowerCase().includes('activity')) {
                response = "Based on your profile showing moderate activity level and recent logs averaging 8,750 steps and 42 active minutes daily, you're doing well with physical activity.\n\nFor someone with mild hypertension, your current activity pattern is beneficial. Some personalized suggestions:\n\n1. Maintain your current step count while gradually working toward 10,000 steps\n2. Consider adding 2 days of strength training weekly, which has specific benefits for blood pressure management\n3. Your walking routine is excellent - adding brief intervals of increased pace can enhance cardiovascular benefits\n4. Monitor your blood pressure before and after exercise occasionally to understand your body's response";
                source = "World Health Organization Physical Activity Guidelines, 2023; American Heart Association, 2023";
            }
            else {
                response = "Based on your health profile with mild hypertension and seasonal allergies, I can provide personalized guidance on several aspects of your health:\n\n- Managing your blood pressure (currently 132/84)\n- Improving your sleep quality (currently averaging 6.5 hours)\n- Optimizing your exercise routine\n- Addressing seasonal allergies\n\nIs there a specific area you'd like me to focus on?";
                source = "";
            }
            
            // Add agent message
            const messageDiv = document.createElement('div');
            messageDiv.className = 'message agent-message';
            
            const content = document.createElement('div');
            content.textContent = response;
            messageDiv.appendChild(content);
            
            if (source) {
                const sourceInfo = document.createElement('div');
                sourceInfo.className = 'source-info';
                sourceInfo.textContent = `Source: ${source}`;
                messageDiv.appendChild(sourceInfo);
            }
            
            const time = document.createElement('div');
            time.className = 'message-time';
            const now = new Date();
            time.textContent = `${now.getHours()}:${now.getMinutes().toString().padStart(2, '0')}`;
            messageDiv.appendChild(time);
            
            chatMessages.appendChild(messageDiv);
            chatMessages.scrollTop = chatMessages.scrollHeight;
        }
        
        function saveHealthData() {
            const dataType = dataTypeSelect.value;
            let message = '';
            
            if (dataType === 'sleep') {
                const hours = document.getElementById('sleep-hours').value;
                const quality = document.getElementById('sleep-quality').value;
                
                if (hours) {
                    document.getElementById('metrics-sleep').textContent = `${hours} hrs, ${quality} quality`;
                    message = `I've recorded your sleep data: ${hours} hours with ${quality} quality. This information will help me provide more personalized recommendations about your energy levels and overall health.`;
                    document.getElementById('sleep-hours').value = '';
                }
            } 
            else if (dataType === 'activity') {
                const steps = document.getElementById('activity-steps').value;
                const minutes = document.getElementById('activity-minutes').value;
                
                if (steps || minutes) {
                    document.getElementById('metrics-activity').textContent = `${steps || 0} steps, ${minutes || 0} min`;
                    message = `I've recorded your activity data: ${steps || 0} steps and ${minutes || 0} active minutes. Regular physical activity is beneficial for managing hypertension and overall health.`;
                    document.getElementById('activity-steps').value = '';
                    document.getElementById('activity-minutes').value = '';
                }
            } 
            else if (dataType === 'bp') {
                const systolic = document.getElementById('systolic').value;
                const diastolic = document.getElementById('diastolic').value;
                
                if (systolic && diastolic) {
                    const bp = `${systolic}/${diastolic}`;
                    document.getElementById('metrics-bp').textContent = bp;
                    
                    message = `I've recorded your blood pressure reading of ${bp}.`;
                    
                    if (systolic > 130 || diastolic > 80) {
                        message += " This is slightly elevated. Given your history of mild hypertension, continue monitoring regularly and maintain your medication regimen.";
                    } else {
                        message += " This is within a good range. Your management approach appears to be working well.";
                    }
                    
                    document.getElementById('systolic').value = '';
                    document.getElementById('diastolic').value = '';
                }
            }
            
            if (message) {
                // Add confirmation message to chat
                addAgentMessage(message);
                
                // Hide form
                dataForm.style.display = 'none';
            }
        }
        
        function showVisualization() {
            // Create visualization message
            const visualizationDiv = document.createElement('div');
            visualizationDiv.className = 'message agent-message';
            
            const content = document.createElement('div');
            content.innerHTML = `
                <p>Here's a visualization of your recent blood pressure readings:</p>
                <div class="visualization">
                    <h3 style="margin-bottom: 10px;">Blood Pressure Trend</h3>
                    <div class="bp-chart">
                        <div class="chart-bar elevated" style="height: 85px;">
                            <div class="chart-label">Apr 13</div>
                            <div class="chart-value">135/85</div>
                        </div>
                        <div class="chart-bar" style="height: 78px;">
                            <div class="chart-label">Apr 15</div>
                            <div class="chart-value">128/78</div>
                        </div>
                        <div class="chart-bar elevated" style="height: 82px;">
                            <div class="chart-label">Apr 17</div>
                            <div class="chart-value">132/84</div>
                        </div>
                    </div>
                    <div style="margin-top: 40px; font-size: 14px;">
                        <strong>Analysis:</strong> Your blood pressure has been fluctuating slightly, but remains in the mildly elevated range. The 132/84 reading on Apr 17 is an improvement from Apr 13, suggesting your medication and lifestyle adjustments are having a positive effect. Continue monitoring regularly and maintaining your current treatment plan.
                    </div>
                </div>
            `;
            
            visualizationDiv.appendChild(content);
            
            const sourceInfo = document.createElement('div');
            sourceInfo.className = 'source-info';
            sourceInfo.textContent = 'Source: American Heart Association Guidelines, 2023';
            visualizationDiv.appendChild(sourceInfo);
            
            const time = document.createElement('div');
            time.className = 'message-time';
            const now = new Date();
            time.textContent = `${now.getHours()}:${now.getMinutes().toString().padStart(2, '0')}`;
            visualizationDiv.appendChild(time);
            
            chatMessages.appendChild(visualizationDiv);
            chatMessages.scrollTop = chatMessages.scrollHeight;
        }
        
        // Profile editor functions
        function initProfileEditor() {
            // Initialize the conditions list
            updateConditionsList();
            
            // Initialize the medications list
            updateMedicationsList();
            
            // Close modal when clicking outside of it
            window.onclick = function(event) {
                if (event.target === profileModal) {
                    profileModal.style.display = "none";
                }
            };
        }
        
        function loadCurrentProfile() {
            // Load personal info
            document.getElementById('edit-age').value = document.getElementById('user-age').textContent;
            
            const genderSelect = document.getElementById('edit-gender');
            const currentGender = document.getElementById('user-gender').textContent;
            for (let i = 0; i < genderSelect.options.length; i++) {
                if (genderSelect.options[i].value === currentGender) {
                    genderSelect.selectedIndex = i;
                    break;
                }
            }
            
            document.getElementById('edit-height').value = document.getElementById('user-height').textContent.replace(' cm', '');
            document.getElementById('edit-weight').value = document.getElementById('user-weight').textContent.replace(' kg', '');
            
            const activitySelect = document.getElementById('edit-activity');
            const currentActivity = document.getElementById('user-activity').textContent;
            for (let i = 0; i < activitySelect.options.length; i++) {
                if (activitySelect.options[i].value === currentActivity) {
                    activitySelect.selectedIndex = i;
                    break;
                }
            }
        }
        
        function savePersonalInfo() {
            // Get form values
            const age = document.getElementById('edit-age').value;
            const gender = document.getElementById('edit-gender').value;
            const height = document.getElementById('edit-height').value;
            const weight = document.getElementById('edit-weight').value;
            const activity = document.getElementById('edit-activity').value;
            
            // Update profile display
            if (age) document.getElementById('user-age').textContent = age;
            if (gender) document.getElementById('user-gender').textContent = gender;
            if (height) document.getElementById('user-height').textContent = height + ' cm';
            if (weight) document.getElementById('user-weight').textContent = weight + ' kg';
            if (activity) document.getElementById('user-activity').textContent = activity;
            
            // Display confirmation message
            const message = "I've updated your personal information. This helps me provide more personalized health recommendations based on your age, gender, body measurements, and activity level.";
            addAgentMessage(message);
            
            // Close modal
            profileModal.style.display = "none";
        }
        
        function updateConditionsList() {
            const container = document.getElementById('conditions-list');
            container.innerHTML = ''; // Clear existing content
            
            // Get all conditions from the sidebar
            const conditions = document.getElementById('health-conditions').querySelectorAll('.health-item');
            
            // Create display for each condition with delete button
            conditions.forEach((condition, index) => {
                const conditionName = condition.querySelector('span:first-child').textContent;
                const conditionDate = condition.querySelector('span:last-child').textContent;
                
                const conditionItem = document.createElement('div');
                conditionItem.className = 'health-item';
                conditionItem.style.display = 'flex';
                conditionItem.style.justifyContent = 'space-between';
                conditionItem.style.alignItems = 'center';
                conditionItem.style.marginBottom = '10px';
                
                const conditionInfo = document.createElement('div');
                conditionInfo.innerHTML = `<strong>${conditionName}</strong> (${conditionDate})`;
                
                const deleteButton = document.createElement('button');
                deleteButton.textContent = 'Remove';
                deleteButton.style.padding = '4px 8px';
                deleteButton.style.backgroundColor = '#e74c3c';
                deleteButton.style.color = 'white';
                deleteButton.style.border = 'none';
                deleteButton.style.borderRadius = '4px';
                deleteButton.style.cursor = 'pointer';
                
                deleteButton.addEventListener('click', function() {
                    // Remove from main display
                    document.getElementById('health-conditions').children[index].remove();
                    
                    // Update the editor list
                    updateConditionsList();
                    
                    // Confirm removal in chat
                    const message = `I've removed ${conditionName} from your health profile. Let me know if you want to add any other health conditions.`;
                    addAgentMessage(message);
                });
                
                conditionItem.appendChild(conditionInfo);
                conditionItem.appendChild(deleteButton);
                container.appendChild(conditionItem);
            });
        }
        
        function addCondition() {
            const conditionName = document.getElementById('new-condition').value.trim();
            const conditionDate = document.getElementById('condition-date').value.trim() || 'Unknown date';
            
            if (!conditionName) return;
            
            // Create condition item
            const conditionItem = document.createElement('div');
            conditionItem.className = 'health-item';
            
            const nameSpan = document.createElement('span');
            nameSpan.textContent = conditionName;
            
            const dateSpan = document.createElement('span');
            dateSpan.textContent = conditionDate;
            
            conditionItem.appendChild(nameSpan);
            conditionItem.appendChild(dateSpan);
            
            // Add to profile
            document.getElementById('health-conditions').appendChild(conditionItem);
            
            // Update editor list
            updateConditionsList();
            
            // Clear input fields
            document.getElementById('new-condition').value = '';
            document.getElementById('condition-date').value = '';
            
            // Add confirmation to chat
            const message = `I've added ${conditionName} to your health profile. This will help me provide recommendations that consider this condition.`;
            addAgentMessage(message);
        }
        
        function updateMedicationsList() {
            const container = document.getElementById('medications-list');
            container.innerHTML = ''; // Clear existing content
            
            // Get all medications from the sidebar
            const medications = document.getElementById('medications').querySelectorAll('.health-item');
            
            // Create display for each medication with delete button
            medications.forEach((medication, index) => {
                const medicationName = medication.querySelector('span:first-child').textContent;
                const medicationDetails = medication.querySelector('span:last-child').textContent;
                
                const medicationItem = document.createElement('div');
                medicationItem.className = 'health-item';
                medicationItem.style.display = 'flex';
                medicationItem.style.justifyContent = 'space-between';
                medicationItem.style.alignItems = 'center';
                medicationItem.style.marginBottom = '10px';
                
                const medicationInfo = document.createElement('div');
                medicationInfo.innerHTML = `<strong>${medicationName}</strong> (${medicationDetails})`;
                
                const deleteButton = document.createElement('button');
                deleteButton.textContent = 'Remove';
                deleteButton.style.padding = '4px 8px';
                deleteButton.style.backgroundColor = '#e74c3c';
                deleteButton.style.color = 'white';
                deleteButton.style.border = 'none';
                deleteButton.style.borderRadius = '4px';
                deleteButton.style.cursor = 'pointer';
                
                deleteButton.addEventListener('click', function() {
                    // Remove from main display
                    document.getElementById('medications').children[index].remove();
                    
                    // Update the editor list
                    updateMedicationsList();
                    
                    // Confirm removal in chat
                    const message = `I've removed ${medicationName} from your medication list. Let me know if you need to add any other medications or have questions about your current treatment plan.`;
                    addAgentMessage(message);
                });
                
                medicationItem.appendChild(medicationInfo);
                medicationItem.appendChild(deleteButton);
                container.appendChild(medicationItem);
            });
        }
        
        function addMedication() {
            const medicationName = document.getElementById('new-medication').value.trim();
            const dosage = document.getElementById('medication-dosage').value.trim();
            const frequency = document.getElementById('medication-frequency').value.trim();
            
            if (!medicationName) return;
            
            // Format details
            const details = [];
            if (dosage) details.push(dosage);
            if (frequency) details.push(frequency);
            const detailsText = details.join(', ') || 'No details provided';
            
            // Create medication item
            const medicationItem = document.createElement('div');
            medicationItem.className = 'health-item';
            
            const nameSpan = document.createElement('span');
            nameSpan.textContent = medicationName;
            
            const detailsSpan = document.createElement('span');
            detailsSpan.textContent = detailsText;
            
            medicationItem.appendChild(nameSpan);
            medicationItem.appendChild(detailsSpan);
            
            // Add to profile
            document.getElementById('medications').appendChild(medicationItem);
            
            // Update editor list
            updateMedicationsList();
            
            // Clear input fields
            document.getElementById('new-medication').value = '';
            document.getElementById('medication-dosage').value = '';
            document.getElementById('medication-frequency').value = '';
            
            // Add confirmation to chat
            const message = `I've added ${medicationName} to your medication list. This will help me consider potential medication effects when providing health recommendations.`;
            addAgentMessage(message);
        }
        
        function addAgentMessage(content, source = '') {
            const messageDiv = document.createElement('div');
            messageDiv.className = 'message agent-message';
            
            const contentElem = document.createElement('div');
            contentElem.textContent = content;
            messageDiv.appendChild(contentElem);
            
            if (source) {
                const sourceInfo = document.createElement('div');
                sourceInfo.className = 'source-info';
                sourceInfo.textContent = `Source: ${source}`;
                messageDiv.appendChild(sourceInfo);
            }
            
            const time = document.createElement('div');
            time.className = 'message-time';
            const now = new Date();
            time.textContent = `${now.getHours()}:${now.getMinutes().toString().padStart(2, '0')}`;
            messageDiv.appendChild(time);
            
            chatMessages.appendChild(messageDiv);
            chatMessages.scrollTop = chatMessages.scrollHeight;
        }
    })();
    </script>
</body>
</html>
